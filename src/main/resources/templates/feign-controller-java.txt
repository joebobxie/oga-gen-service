package [(${config.packageName})].module.[(${table.config.catalog})].controller.feign;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.TypeReference;
import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import [(${config.groupId})].model.common.ApiRest;
import [(${config.groupId})].model.common.BaseController;
import [(${config.groupId})].model.dto.BaseIdDTO;
import [(${config.groupId})].model.dto.BaseIdsDTO;
import [(${config.groupId})].model.dto.PagingDTO;
import [(${config.groupId})].model.module.[(${config.name})].[(${table.config.catalog})].dto.[(${table.className})]FeignDTO;
import [(${config.groupId})].model.module.[(${config.name})].[(${table.config.catalog})].vo.[(${table.className})]FeignVO;
import [(${config.groupId})].[(${config.name})].module.[(${table.config.catalog})].entity.[(${table.className})]Entity;
import [(${config.groupId})].[(${config.name})].module.[(${table.config.catalog})].service.[(${table.className})]Service;
import [(${config.groupId})].model.utility.BeanMapper;
import [(${config.groupId})].model.vo.BaseIdVO;
import [(${config.groupId})].model.vo.PagingVO;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.BeanUtils;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.Resource;
import java.util.List;

/**
* [(${table.describe})]
*/
@Api(tags={"[(${table.describe})]"})
@RestController
@RequestMapping("/[(${config.name})]/feign/[(${table.config.catalog})]/[(${table.config.path})]")
public class [(${table.className})]FeignController extends BaseController {

    /**
    * 用户角色服务
    */
    @Resource
    [(${table.className})]Service baseService;

    /**
    * 添加或修改
    */
    @ApiOperation(value = "添加或修改")
    @RequestMapping(value = "/update", method = { RequestMethod.POST})
    public ApiRest<BaseIdVO> [(${table.config.className})]FeignSaveOrUpdate(@RequestBody [(${table.className})]FeignDTO dto) {
        [(${table.className})]Entity entity = new [(${table.className})]Entity();
        BeanMapper.copy(dto, entity);
        baseService.saveOrUpdate(entity);
        return super.success(new BaseIdVO(entity.getId()));
    }

    /**
    * 删除
    */
    @ApiOperation(value = "删除")
    @RequestMapping(value = "/delete", method = { RequestMethod.POST})
    public ApiRest [(${table.config.className})]FeignDelete(@RequestBody BaseIdsDTO dto) {
        baseService.removeByIds(dto.getIds());
        return super.success();
    }

    /**
    * 详情
    */
    @ApiOperation(value = "详情")
    @RequestMapping(value = "/detail", method = { RequestMethod.POST})
    public ApiRest<[(${table.className})]FeignVO> [(${table.config.className})]FeignDetail(@RequestBody BaseIdDTO dto) {
        [(${table.className})]Entity entity = baseService.getById(dto.getId());
        [(${table.className})]FeignVO vo = new [(${table.className})]FeignVO();
        BeanUtils.copyProperties(entity, vo);
        return super.success(vo);
    }

    /**
    * 分页数据
    */
    @ApiOperation(value = "分页查找")
    @RequestMapping(value = "/paging", method = { RequestMethod.POST})
    public ApiRest<PagingVO<[(${table.className})]FeignVO>> [(${table.config.className})]FeignPaging(@RequestBody PagingDTO<[(${table.className})]FeignDTO> dto) {
        Page query = new Page(dto.getCurrent(), dto.getSize());
        QueryWrapper<[(${table.className})]Entity> queryWrapper = new QueryWrapper<>();
        IPage<[(${table.className})]Entity> pageData = baseService.[(${table.config.className})]Paging(query, queryWrapper);
        PagingVO<[(${table.className})]FeignVO> data = JSON.parseObject(JSON.toJSONString(pageData), new TypeReference<PagingVO<[(${table.className})]FeignVO>>(){});
        return super.success(data);
    }

    /**
     * 列表数据
     */
    @ApiOperation(value = "查找列表")
    @RequestMapping(value = "/list", method = { RequestMethod.POST})
    public ApiRest<List<[(${table.className})]FeignVO>> [(${table.config.className})]FeignList(@RequestBody [(${table.className})]FeignDTO dto) {
        QueryWrapper<[(${table.className})]Entity> wrapper = new QueryWrapper<>();
        List<[(${table.className})]Entity> list = baseService.[(${table.config.className})]List(wrapper);
        List<[(${table.className})]FeignVO> voList = BeanMapper.mapList(list, [(${table.className})]FeignVO.class);
        return super.success(voList);
    }
}
